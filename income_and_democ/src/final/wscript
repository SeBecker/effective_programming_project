#! python


def build(ctx):

    tables = [
        'FHI',
        'POL'
    ]

    figures = [
        'F1',
        'F2',
        'F3',
        'F4',
        'F5',
        'F6'
    ]

    for t in tables:

        ctx(
            features='subst',
            source='table12.do',
            target='{}_table12.do'.format(t)
        )
        ctx(
            features='run_do_script',
            source='{}_table12.do'.format(t),
            target=[
                ctx.path_to(ctx, 'OUT_FINAL', 'log',
                            '{}_table12.log'.format(t)),
                ctx.path_to(ctx, 'OUT_TABLES',
                            '{}.tex'.format(t))
            ],
            deps=[
                ctx.path_to(ctx, 'OUT_ANALYSIS', '{}_estimation_results.dta'.format(t))
            ],
            name='{}_table12'.format(t),
            append=t
        )

        ctx(
            features='subst',
            source='robust_table.do',
            target='{}_robust_table.do'.format(t)
        )
        ctx(
            features='run_do_script',
            source='{}_robust_table.do'.format(t),
            target=[
                ctx.path_to(ctx, 'OUT_FINAL', 'log',
                            '{}_robust_table.log'.format(t)),
                ctx.path_to(ctx, 'OUT_TABLES',
                            '{}_robust.tex'.format(t))
            ],
            deps=[
                ctx.path_to(ctx, 'OUT_ANALYSIS', '{}_robustness_check_results.dta'.format(t))
            ],
            name='{}_robust_table'.format(t),
            append=t
        )

    for f in figures:

        if f == 'F6':
            ctx(
                features='subst',
                source='figures6.do',
                target='{}_figures6.do'.format(f)
            )
            ctx(
                features='run_do_script',
                source='{}_figures6.do'.format(f),
                target=[
                    ctx.path_to(ctx, 'OUT_FINAL', 'log',
                                '{}_figures6.log'.format(f)),
                    ctx.path_to(ctx, 'OUT_FIGURES',
                                '{}.eps'.format(f))
                ],
                deps=[
                    ctx.path_to(ctx, 'OUT_DATA', '{}_all.dta'.format(f))
                ],
                name='{}_figures6'.format(f),
                append=f
            )

        else:
            ctx(
                features='subst',
                source='figures.do',
                target='{}_figures.do'.format(f)
            )
            ctx(
                features='run_do_script',
                source='{}_figures.do'.format(f),
                target=[
                    ctx.path_to(ctx, 'OUT_FINAL', 'log',
                                '{}_figures.log'.format(f)),
                    ctx.path_to(ctx, 'OUT_FIGURES',
                                '{}.eps'.format(f))
                ],
                deps=[
                    ctx.path_to(ctx, 'OUT_DATA', '{}_all.dta'.format(f))
                ],
                name='{}_figures'.format(f),
                append=f
            )
